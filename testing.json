{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "width": 600,
    "height": 300,
    "title": {
      "text": "WHERE REFUGEES IN MALAYSIA CAME FROM?",
      "font": "Georgia",
      "fontSize": 32,
      "color": "white",
      "subtitle": [
        "Malaysia hosts some 181,000 refugees and asylum-seekers. 85% are from Myanmar, including some 103,000 Rohingyas.",
        "The remaining are from 50 other countries, including Pakistan, Yemen, Syria, and Somalia.",
        "They live in cities and towns across the peninsular with sizeable populations in Klang Valley, Johor, and Penang."
      ],
      "subtitleFont": "Calibri",
      "subtitleFontSize": 15,
      "subtitleFontWeight": "lighter",
      "subtitleColor": "white"
    },
    "params": [
      {
        "name": "year",
        "value": 2011,
        "bind": {
          "input": "range",
          "min": 2003,
          "max": 2023,
          "step": 1,
          "name": "Select the year: "
        }
      }
    ],
    "projection": {
      "type": "equalEarth"
    },
    "layer": [
      {
        "data": {
          "url": "ne_110m.json",
          "format": { "type": "topojson", "feature": "ne_110m_admin_0_countries" }
        },
        "mark": {
          "type": "geoshape",
          "fill": "lightgray",
          "stroke": "white",
          "strokeWidth": 0.5
        }
      },
      {
        "data": {
          "url": "DataProcessing/cleaned_population_new.csv",
          "format": {
            "type": "csv"
          }
        },
        "transform": [
          {
            "filter": "datum.year == year"
          },
          {
            "calculate": "datum.refugees_under_unhcr_mandate + datum.asylum_seekers + datum.stateless_persons",
            "as": "total_refugees"
          },
          {
            "aggregate": [
              {
                "op": "sum",
                "field": "total_refugees",
                "as": "total_refugees_sum"
              }
            ],
            "groupby": ["country_of_origin_iso", "year"]
          },
          {
            "lookup": "country_of_origin_iso",
            "from": {
              "data": {
                "url": "ne_110m.json",
                "format": { "type": "topojson", "feature": "ne_110m_admin_0_countries" }
              },
              "key": "properties.ISO_A3",
              "fields": ["properties.ISO_A3"]  
            }
          }
        ],
        "mark": {
          "type": "geoshape"
        },
        "encoding": {
          "color": {
            "field": "total_refugees_sum",
            "type": "quantitative",
            "scale": {
              "scheme": "reds",
              "domain": [20, 200, 2000, 20000, 200000]
            },
            "legend": {
              "title": "Total Number of Refugees",
              "labelFont": "Segoe UI",
              "labelFontSize": 10,
              "labelColor": "white",
              "titleFont": "Segoe UI",
              "titleFontSize": 11,
              "titleColor": "white"
            }
          },
          "tooltip": [
            {
              "field": "properties.ISO_A3",  
              "type": "nominal",
              "title": "Country"
            },
            {
              "field": "total_refugees_sum",
              "type": "quantitative",
              "title": "Total Refugees"
            }
          ]
        }
      }
    ],
    "config": {
      "padding": { "top": 20, "left": 20, "right": 80 },
      "background": "black",
      "legend": {
        "direction": "vertical",
        "legendX": 610,
        "legendY": 570,
        "gradientLength": 300,
        "labelFont": "Segoe UI",
        "labelFontSize": 10,
        "labelColor": "white",
        "titleFont": "Segoe UI",
        "titleFontSize": 11,
        "titleFontWeight": "lighter",
        "titleColor": "white"
      }
    }
  }
  